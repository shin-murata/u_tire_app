{% extends "base.html" %}
{% block content %}
<div class="container my-4">
    <h5>以下のタイヤを出庫しますか？</h5>
    <form method="POST" action="{{ url_for('dispatch') }}">
        <div class="tire-confirmation">
            <h5>共通データ</h5>
            <div class="tire-form">
                <!-- 登録日（単独表示） -->
                <div class="form-group registration-date">
                    <p id="dispatch_date" class="value">{{ dispatch_date }}</p>
                </div>
        
                <!-- 1段目と2段目を横並びに表示 -->
                <div class="form-group data-rows">
                    <!-- 1段目: 幅と扁平率 -->
                    <div class="data-group data-group-1">
                        <input type="hidden" name="width" value="{{ tires_to_dispatch[0].width_ref.value }}">
                        <p id="width" class="value">{{ tires_to_dispatch[0].width_ref.value }}</p>
                        <span class="separator">/</span>
                        <input type="hidden" name="aspect_ratio" value="{{ tires_to_dispatch[0].aspect_ratio_ref.value }}">
                        <p id="aspect_ratio" class="value">{{ tires_to_dispatch[0].aspect_ratio_ref.value }}</p>
                    </div>
                    <!-- 2段目: R, インチとプライレーティング -->
                    <div class="data-group data-group-2">
                        <span class="prefix">R</span>
                        <input type="hidden" name="inch" value="{{ tires_to_dispatch[0].inch_ref.value }}">
                        <p id="inch" class="value">{{ tires_to_dispatch[0].inch_ref.value }}</p>
                        <input type="hidden" name="ply_rating" value="{{ tires_to_dispatch[0].ply_rating_ref.value }}">
                        <p id="ply_rating" class="value">{{ tires_to_dispatch[0].ply_rating_ref.value }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 個別データの一覧表示 -->
        <h5>個別データ</h5>
        <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover">
                <thead class="thead-light">
                    <tr>
                        <th style="min-width: 80px;">在庫番号</th>
                        <th style="min-width: 120px;">メーカー</th>
                        <th style="min-width: 80px;">製造年</th>
                        <th style="min-width: 80px;">溝</th>
                        <th style="min-width: 80px;">片減り</th>
                        <th style="min-width: 100px;">その他の詳細</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tire in tires_to_dispatch %}
                    <tr>
                        <td>{{ tire.id }}</td>
                        <td>{{ tire.manufacturer_ref.name }}</td>
                        <td>{{ tire.manufacturing_year }}</td>
                        <td>{{ tire.tread_depth }}</td>
                        <td>{{ tire.uneven_wear }}</td>
                        <td>{{ tire.other_details }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <button type="submit" class="btn btn-success">確認</button>
    </form>
    <!-- 戻るボタン -->
    <form method="POST" action="{{ url_for('search_page') }}">
        <input type="hidden" name="action" value="back">

        <!-- 検索条件を隠しフィールドで送信 -->
        <input type="hidden" name="width" value="{{ session.get('search_conditions', {}).get('width', '') }}">
        <input type="hidden" name="aspect_ratio" value="{{ session.get('search_conditions', {}).get('aspect_ratio', '') }}">
        <input type="hidden" name="inch" value="{{ session.get('search_conditions', {}).get('inch', '') }}">
        <input type="hidden" name="ply_rating" value="{{ session.get('search_conditions', {}).get('ply_rating', '') }}">

        <!-- 選択済みのタイヤIDを送信 -->
        {% for tire in selected_tires %}
            <input type="hidden" name="tire_ids" value="{{ tire.id }}">
            <!-- デバッグ用 -->
            <span>{{ tire.id }} {{ 'checked' if tire.id|string in selected_tires else '' }}</span>
        {% endfor %}
        <!-- 戻るボタン -->
        <!-- 戻るボタン -->
        <button type="button" class="btn btn-secondary" id="backButton"
            data-url="{{ url_for('dispatch_confirm', action='back') }}">
            戻る
        </button>
    </form>
</div>
{% endblock %}
